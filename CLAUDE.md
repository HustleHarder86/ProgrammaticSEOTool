# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What is AI-Powered Programmatic SEO?

Programmatic SEO enhanced with **AI-driven strategy generation** that creates custom, business-specific templates and content strategies. Instead of static templates, AI analyzes each business to generate tailored programmatic SEO strategies that serve real user search intent.

**Traditional Examples:**
- Tripadvisor: "Things to do in [City]" - thousands of city pages from one template
- Zillow: "[City] Real Estate" - location-based property pages
- Yelp: "Best [Business Type] in [City]" - local business directory pages

**AI-Enhanced Examples:**
- Real Estate SaaS: AI generates "Is {Property Type} profitable in {City}? ROI Analysis" 
- Investment Platform: AI creates "{City} {Property Type} Investment Calculator"
- Market Analysis: AI designs "Best {Neighborhoods} in {City} for {Property Type} Investment"

**Revolutionary Formula: Business Analysis + AI Strategy Generation + Custom Templates + Data = Scale with Intent**

## Project Overview

The **AI Strategy-Driven Programmatic SEO Tool** revolutionizes content creation by generating custom, business-specific SEO strategies instead of using static templates. AI analyzes each business to create tailored templates, data strategies, and content frameworks that serve real user search intent.

### Revolutionary Features

1. **AI Business Intelligence Analyzer**
   - Deep analysis of business model, market position, and customer behavior
   - Identifies actual search intents and user pain points
   - Maps customer journey stages and search patterns
   - Discovers competitive gaps and opportunities

2. **Dynamic Template Generation**
   - AI creates custom templates based on business analysis
   - Templates designed around actual user search intent
   - Multiple template variations for different customer journey stages
   - No more generic "Service in City" patterns

3. **Intelligent Data Strategy Generator**
   - AI recommends optimal data sources and structures
   - Creates data collection plans tailored to business needs
   - Suggests variable combinations for maximum page coverage
   - Validates data quality and relevance

4. **Content Strategy Framework**
   - AI designs content pillars and topic clusters
   - Creates SEO-optimized content architectures
   - Plans internal linking and site structure
   - Ensures content serves real user value

5. **Implementation & Scale**
   - Convert AI strategy into working templates
   - Generate hundreds/thousands of pages with meaningful content
   - Professional quality that ranks and converts
   - Export to CSV, WordPress XML, or API formats

## ðŸš€ AI Strategy-First Architecture

**REVOLUTIONARY APPROACH**: This tool uses AI to generate custom programmatic SEO strategies instead of static templates.

**Business Analysis + AI Strategy Generation + Custom Templates + Data = Scale with Intent**

### AI Strategy Generation Process:
1. **Deep Business Analysis** - AI understands your business model, customers, market
2. **Opportunity Discovery** - AI identifies scalable content opportunities specific to your industry
3. **Dynamic Template Creation** - AI generates custom templates based on real user search intent
4. **Data Strategy Design** - AI recommends optimal data structures and sources
5. **Content Framework** - AI creates SEO architecture and content strategy

### Why AI Strategy Generation is Revolutionary:
- **Business-Specific**: Every strategy is tailored to your unique business
- **Intent-Driven**: Templates serve actual user search intent, not generic patterns
- **Scalable Quality**: Maintains excellence even with thousands of pages
- **Competitive Advantage**: Creates opportunities competitors don't have

### AI Configuration Required:
Set at least one environment variable:
- `OPENAI_API_KEY=your_openai_key`
- `ANTHROPIC_API_KEY=your_anthropic_key`
- `PERPLEXITY_API_KEY=your_perplexity_key`

### New API Endpoints:
- `POST /api/generate-ai-strategy` - Generate complete custom strategy
- `POST /api/projects/{id}/implement-ai-strategy` - Convert strategy to templates

## Architecture Components

### Revolutionary AI Strategy System

#### 1. AI Business Intelligence Analyzer (`AIStrategyGenerator`)
- **Purpose**: Deep business analysis and custom strategy generation
- **Key Functions**:
  - Analyze business model, market position, customer behavior
  - Map customer search journey and intent patterns
  - Identify competitive gaps and scalable opportunities
  - Generate comprehensive business intelligence reports

#### 2. Dynamic Template Generator (AI-Driven)
- **Purpose**: Create custom templates based on business analysis
- **Key Functions**:
  - Generate templates that serve real user search intent
  - Design multiple template variations for different journey stages
  - Create business-specific variable structures
  - Eliminate generic "Service in City" patterns

#### 3. Intelligent Data Strategy Generator
- **Purpose**: Design optimal data collection and structuring plans
- **Key Functions**:
  - Recommend data sources tailored to business needs
  - Create data validation and quality requirements
  - Plan variable combinations for maximum coverage
  - Design scalable data collection workflows

#### 4. Content Strategy Framework Generator
- **Purpose**: Design SEO architecture and content planning
- **Key Functions**:
  - Create content pillars and topic clusters
  - Plan internal linking strategies
  - Design scalable content quality standards
  - Ensure content serves genuine user value

#### 5. AI-Powered Page Generator (`SmartPageGenerator`)
- **Purpose**: Generate high-quality pages using AI and real data
- **Key Functions**:
  - Create unique, valuable content for each page
  - Use real market data and business insights
  - Maintain professional quality at scale
  - Optimize for search engines and user experience

#### 6. Strategy Implementation Engine
- **Purpose**: Convert AI strategies into working templates and data
- **Key Functions**:
  - Transform strategy into database templates
  - Set up data structures and validation
  - Create implementation timelines
  - Enable seamless scaling to production

## AI Strategy Generation Examples

### Real Estate Investment SaaS
**Business Input**: "Real estate investment analysis platform helping investors evaluate ROI, cash flow, and market trends"

**AI-Generated Strategy**:
- **Templates**: 
  - "Is {Property Type} profitable in {City}? 2024 ROI Analysis"
  - "{City} {Property Type} Investment Calculator - Market Data"
  - "Best {Neighborhoods} in {City} for {Property Type} Investment"
- **Data Strategy**: Cities, property types, neighborhoods, rental rates, occupancy data
- **Content Focus**: Investment analysis, ROI calculations, market insights
- **Result**: 500+ pages serving actual investor search intent with real market data

### Project Management SaaS
**Business Input**: "Project management software for construction companies with time tracking and resource management"

**AI-Generated Strategy**:
- **Templates**:
  - "{Industry} Project Management Software Comparison 2024"
  - "How to Manage {Project Type} Projects: Complete Guide"
  - "{Industry} Resource Planning: Tools and Best Practices"
- **Data Strategy**: Industries, project types, tools, methodologies
- **Content Focus**: Industry-specific guidance, tool comparisons, implementation guides
- **Result**: 300+ pages serving specific industry needs with actionable insights

### E-commerce Analytics Platform
**Business Input**: "Analytics platform helping e-commerce stores optimize conversion rates and customer experience"

**AI-Generated Strategy**:
- **Templates**:
  - "{E-commerce Platform} Conversion Rate Optimization Guide"
  - "How to Increase {Metric} for {Store Type}: Data-Driven Strategies"
  - "{Industry} E-commerce Analytics: Key Metrics and Tools"
- **Data Strategy**: E-commerce platforms, metrics, store types, industries
- **Content Focus**: Platform-specific optimization, metric improvement, industry insights
- **Result**: 400+ pages with platform-specific, actionable optimization strategies

## Development Guidelines

When implementing features:
1. **AI Strategy-First**: Use AI to generate custom strategies instead of static templates
2. **Business-Specific**: Every solution should be tailored to the specific business and industry
3. **Intent-Driven**: Ensure all templates serve real user search intent, not generic patterns
4. **AI Requirement**: Validate AI providers are configured for all strategy generation
5. **Data Strategy**: Use AI to recommend optimal data structures for each business
6. **Quality at Scale**: AI ensures unique, valuable content even for thousands of pages
7. **User Value**: Every page must provide genuine value to the end user
8. **Scale Testing**: Test with hundreds of combinations to ensure performance

### AI Strategy Development Process
1. **Business Analysis**: Use AI to deeply understand the business model and market
2. **Opportunity Discovery**: Identify scalable content opportunities specific to the industry
3. **Template Generation**: Create custom templates based on real user search patterns
4. **Data Planning**: Design optimal data collection and validation strategies
5. **Implementation**: Convert strategies into working templates and content systems

### AI Configuration Validation
- Always check AI provider availability before strategy generation
- Provide clear error messages with setup instructions when AI is missing
- Use debug endpoints to verify AI configuration in production
- Test strategy generation with sample business inputs

## CRITICAL: Testing & Quality Assurance Protocol

**MANDATORY TESTING BEFORE ANY CODE PUSH:**

When debugging or fixing any issue, you MUST follow this comprehensive testing protocol:

### 1. Pre-Push Testing Requirements
Before pushing ANY code changes, you MUST:

1. **Create comprehensive tests** that validate the specific functionality being fixed
2. **Test edge cases and error scenarios** - don't just test the happy path
3. **Run integration tests** to ensure the fix doesn't break other parts
4. **Validate end-to-end workflows** from user input to final output
5. **Test with real data scenarios** that match production usage
6. **Verify error handling and fallback mechanisms** work properly

### 2. Content Generation Testing Protocol
For any content generation fixes, you MUST:

1. **Test all content types** (evaluation_question, location_service, comparison, generic)
2. **Validate variable substitution** - ensure no "various options" or placeholder text
3. **Check content quality** - verify 300-400 word count, proper grammar, coherent structure
4. **Test AI provider scenarios** - both with and without AI providers configured
5. **Verify data flow** - ensure DataEnricher data reaches ContentPatterns properly
6. **Quality score validation** - ensure scoring reflects actual content quality

### 3. Test Creation Guidelines
When creating tests:

1. **Write test scripts** that can be run automatically to validate fixes
2. **Include both unit tests** (individual components) and **integration tests** (full workflows)
3. **Test with multiple business types** to ensure universal compatibility
4. **Create test data** that represents real user scenarios
5. **Document test results** with clear pass/fail criteria

### 4. Deployment Testing
Before deploying to Railway/Vercel:

1. **Test locally first** - ensure all functionality works in local environment
2. **Run test suite** - execute all relevant tests and document results
3. **Test API endpoints** - verify all endpoints respond correctly
4. **Check logs** - ensure no errors or warnings in application logs
5. **Performance testing** - validate generation speed and memory usage

### 5. Bug Discovery Protocol
When testing reveals additional bugs:

1. **Document all bugs found** - create comprehensive list with reproduction steps
2. **Fix all related issues** - don't just fix the original problem
3. **Re-test after each fix** - verify fixes don't introduce new problems
4. **Update test suite** - add tests for newly discovered edge cases

### 6. User Acceptance Validation
For major fixes, include:

1. **Test the exact user scenario** that revealed the original problem
2. **Validate output quality** meets user expectations
3. **Check for regressions** - ensure previously working features still work
4. **Performance benchmarks** - ensure changes don't slow down the system

### Example Testing Workflow:
```bash
# 1. Create test for the specific issue
python test_content_generation_fix.py

# 2. Run comprehensive test suite
python test_full_system.py

# 3. Test API endpoints
python test_api_integration.py

# 4. Validate with real scenarios
python test_user_scenarios.py

# 5. Check performance
python test_performance_benchmarks.py
```

**NO CODE SHOULD BE PUSHED WITHOUT COMPLETING THIS TESTING PROTOCOL**

This ensures that manual testing by the user is minimized and issues are caught before deployment.

## Deployment Configuration (CRITICAL)

**This project uses a separated architecture: Frontend on Vercel, Backend on Railway**

### Current Deployment Architecture
1. **Frontend**: Next.js deployed on Vercel
2. **Backend**: FastAPI deployed on Railway (separate project)
3. **Communication**: Frontend calls Railway backend via environment variable URL
4. **Why Separated**: Vercel couldn't handle mixed Python/Next.js well (discovered during development)

### Deployment URLs
- **Frontend (Vercel)**: https://programmatic-seo-tool.vercel.app
- **Backend (Railway)**: https://programmaticseotool-production.up.railway.app

### Frontend (Vercel) Requirements
1. **Next.js Only**: Pure Next.js frontend, no Python
2. **Environment Variable**: `NEXT_PUBLIC_API_URL` points to Railway backend
3. **API Calls**: Use axios client with backend URL from environment
4. **CORS**: Backend configured to accept Vercel frontend origin

### Backend (Railway) Requirements
1. **FastAPI Application**: Full backend in `/backend` directory
2. **Database**: SQLite for persistence
3. **Environment Variables**: AI provider keys set in Railway
4. **CORS Middleware**: Configured to accept frontend domain

### All Subagents MUST Follow These Rules:
1. **Keep frontend and backend separate** - they deploy to different platforms
2. **Use environment variable for API URL** in frontend (not hardcoded)
3. **Frontend uses `NEXT_PUBLIC_API_URL`** for all API calls
4. **Test CORS configuration** when making API changes
5. **Update both deployments** when making breaking changes

### Current vercel.json Structure (Frontend Only):
```json
{
  "framework": "nextjs"
}
```

## Workflow Rules

When working on any development task, follow these steps:

1. **First think through the problem** - Read the codebase for relevant files and write a plan to tasks/todo.md
2. **Create checkable todo items** - The plan should have a list of todo items that you can check off as you complete them
3. **Check in before starting** - Before beginning work, verify the plan with the user
4. **Work systematically** - Begin working on the todo items, marking them as complete as you go
5. **Provide high-level explanations** - Every step of the way, give a high-level explanation of what changes were made
6. **Keep it simple** - Make every task and code change as simple as possible. Avoid massive or complex changes. Every change should impact as little code as possible. Everything is about simplicity.
7. **Add review section** - Finally, add a review section to the todo.md file with a summary of the changes made and any other relevant information

## Development Commands

### Run Locally
```bash
# Option 1: Run both servers with one command
python run_local.py

# Option 2: Run servers separately
# Terminal 1 - API (FastAPI)
python -m uvicorn app.main:app --reload

# Terminal 2 - Frontend (Next.js)
cd frontend
npm run dev
```

### Initialize Database
```bash
python init_db.py
```

### Deploy to Vercel
```bash
vercel
```

## API Endpoints

- `GET /health` - Health check
- `POST /api/analyze-business` - Analyze business from text or URL
- `POST /api/generate-templates` - Generate programmatic SEO template opportunities
- `POST /api/create-template` - Create or save a page template
- `POST /api/import-data` - Import data for template variables
- `POST /api/generate-pages` - Generate all pages from template + data
- `POST /api/export` - Export pages (CSV, JSON, WordPress)

## Environment Variables Required

- `OPENAI_API_KEY` or `ANTHROPIC_API_KEY` or `PerplexityAPI` - At least one AI provider
- Optional: `WORDPRESS_URL`, `WORDPRESS_USERNAME`, `WORDPRESS_APP_PASSWORD` for direct publishing

## Important Implementation Notes

### What Works (Keep These)
1. **Perplexity API Configuration**: Use model "sonar" - tested and working
2. **URL Content Extraction**: Current implementation successfully extracts business info
3. **Business Analysis**: `analyze_business_comprehensive()` provides good foundation
4. **Content Variation Engine**: Uniqueness algorithms work well for bulk pages
5. **Vercel Deployment**: Current setup works without filesystem errors

### Common Pitfalls to Avoid
1. **Don't focus on keyword discovery** - Users will provide their own data
2. **Don't estimate traffic/metrics** - Focus on page generation only
3. **Don't create complex wizards** - Simple template â†’ data â†’ pages flow
4. **Don't generate individual content** - Think bulk generation from templates

## Current Status (As of January 2025)

### âœ… Completed (January 13, 2025 - Latest Updates)
- **Backend Deployment**: Successfully deployed minimal FastAPI backend on Railway
- **Frontend-Backend Connection**: Frontend on Vercel connected to Railway backend
- **Business Analysis API**: Working endpoint with Perplexity AI integration
- **AI Response Parsing**: Fixed JSON parsing from Perplexity markdown responses
- **API Connectivity**: Full frontend-backend communication working
- **Business Analysis**: AI successfully analyzes businesses and suggests templates
- **Template Creation**: Templates can be created with proper variable format ({Variable} not [Variable])
- **Project Management**: Full CRUD operations for projects working
- **AI-Powered Data Generation**: Automatic variable generation eliminates manual CSV creation
- **Smart Content Generation**: AI + real data creates valuable, Yelp/Zapier-style content
- **Data Enrichment System**: Provides real market statistics for accurate content

### ðŸ†• Latest Implementation: Smart AI Content Generation
1. **DataEnricher Class** (`backend/data_enricher.py`)
   - Provides real market data (rental rates: $127/night, occupancy: 68%)
   - Calculates ROI and profitability metrics
   - Returns data quality scores for content generation

2. **SmartPageGenerator Class** (`backend/smart_page_generator.py`)
   - Uses AI + real data to generate valuable content
   - Answers questions accurately with statistics
   - Falls back to patterns if AI unavailable
   - 300-400 words of data-driven content per page

3. **Content Quality Improvement**
   - Before: "Find 55 services options in Winnipeg. Most popular: Highly Rated Pro."
   - After: "Yes, single-family homes in Winnipeg can be profitable short-term rentals. Average nightly rate: $127 with 68% occupancy. Current market has 342 active STRs, up 23% from last year."

### ðŸ”§ Key Learnings from Development
1. **AI Integration Works**: Perplexity API successfully generates relevant template suggestions
2. **Variable Format**: Templates must use {Variable} format, not [Variable]
3. **Data Format**: API expects list of dictionaries, not dictionary of lists
4. **Programmatic SEO Formula**: Volume + Real Data = Success (not perfect content)
5. **User Experience**: AI-generated data eliminates CSV creation friction
6. **Content Strategy**: Follow Yelp/Zapier model - real data presented simply

### ðŸ’¡ Problem Solved: No More Manual CSV Creation
The tool now uses AI to automatically:
1. Generate relevant variables based on template and business context
2. Create realistic data combinations (cities, services, products)
3. Produce 10-1000s of page variations instantly
4. Ensure data quality and relevance

### ðŸš€ Working Endpoints
- `GET /health` - Health check
- `GET /api/test` - Test endpoint  
- `POST /api/analyze-business` - AI-powered business analysis
- `POST /api/projects/{id}/templates/{tid}/generate-variables` - AI variable generation
- `POST /api/projects/{id}/templates/{tid}/generate` - Smart page generation with real data
- Full project, template, data, and page generation APIs

## Current Status (Original)

### Completed
- **Agent Architecture**: All 5 core agents (Business Analyzer, Template Builder, Data Manager, Page Generator, Export Manager) are fully implemented
- **API Integration**: Complete REST API with all endpoints working
- **AI Support**: Perplexity, OpenAI, and Anthropic providers integrated
- **Database**: SQLite database with full project/content tracking
- **Export Formats**: CSV, JSON, WordPress XML export working
- **Workflow Automation**: Complete end-to-end workflow from business analysis to export

### In Progress
- **Next.js Frontend**: Building a modern React-based UI with Next.js 14 App Router
- **Real SEO Data**: Currently using AI-generated mock data; need to integrate Ubersuggest/SerpAPI for real metrics

### Next Steps
1. Create the Next.js frontend with modern UI components and workflow
2. Test the complete workflow end-to-end
3. Integrate real SEO data providers
4. Add production-ready error handling and logging

## Frontend Architecture (Next.js)

### Technology Stack
- **Framework**: Next.js 14 with App Router
- **UI Components**: shadcn/ui + Tailwind CSS
- **State Management**: Zustand for global state
- **Data Fetching**: TanStack Query (React Query)
- **Forms**: React Hook Form + Zod validation
- **Charts**: Recharts for data visualization

### Key Frontend Features
1. **Responsive Design**: Mobile-first approach
2. **Real-time Updates**: WebSocket support for long-running tasks
3. **File Uploads**: Drag-and-drop CSV import
4. **Interactive Preview**: Live template preview with data
5. **Export Queue**: Background export processing with progress